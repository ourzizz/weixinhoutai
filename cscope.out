cscope 16 C:\Qt\Qt5.7.1\5.7\mingw53_32\myproj\weixinhoutai               0000022123
	@employeeform.cpp

1 
	~<QtSql
>

2 
	~<QtWidg‘s
>

3 
	~"em¶oy“fÜm.h
"

4 
	~<QMes§geBox
>

6 
	gEm¶oy“FÜm
::
	$Em¶oy“FÜm
(
id
,
feid
,
QWidg‘
 *
·»Á
)

7 : 
	$QDŸlog
(
·»Á
)

9 
ÇmeEd™
 = 
Ãw
 
QLšeEd™
;

10 
ÇmeLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("æ¶ˆæ¯å†…å®¹:"));

11 
ÇmeLab–
->
	`£tBuddy
(
ÇmeEd™
);

13 
d•¬tm’tComboBox
 = 
Ãw
 
QComboBox
;

14 
d•¬tm’tLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("æ‰€å±æ–‡ä»¶"));

15 
d•¬tm’tLab–
->
	`£tBuddy
(
d•¬tm’tComboBox
);

17 
ex‹nsiÚLšeEd™
 = 
Ãw
 
QLšeEd™
;

18 
ex‹nsiÚLšeEd™
->
	`£tV®id©Ü
(
Ãw
 
	`QIÁV®id©Ü
(0, 99999, 
this
));

20 
ex‹nsiÚLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("å‘å¸ƒæ—¶é—´"));

21 
ex‹nsiÚLab–
->
	`£tBuddy
(
ex‹nsiÚLšeEd™
);

23 
emaEd™
 = 
Ãw
 
QLšeEd™
;

24 
emaLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("æ‰€å±è€ƒè¯•"));

25 
emaLab–
->
	`£tBuddy
(
emaEd™
);

27 
¡¬tD©eEd™
 = 
Ãw
 
QD©eEd™
;

28 
¡¬tD©eEd™
->
	`£tC®’d¬Pİup
(
Œue
);

29 
QD©e
 
today
 = QD©e::
	`cu¼’tD©e
();

30 
¡¬tD©eEd™
->
	`£tD©eRªge
(
today
.
	`addDays
(-90),oday.addDays(90));

31 
¡¬tD©eLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("&å¤±æ•ˆæ—¶é—´:"));

32 
¡¬tD©eLab–
->
	`£tBuddy
(
¡¬tD©eEd™
);

39 
addBu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("&Add"));

40 
d–‘eBu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("&Delete"));

41 
şo£Bu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("&Close"));

43 
bu‰ÚBox
 = 
Ãw
 
QDŸlogBu‰ÚBox
;

44 
bu‰ÚBox
->
	`addBu‰Ú
(
addBu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

45 
bu‰ÚBox
->
	`addBu‰Ú
(
d–‘eBu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

46 
bu‰ÚBox
->
	`addBu‰Ú
(
şo£Bu‰Ú
, 
QDŸlogBu‰ÚBox
::
Acû±RŞe
);

48 
bËMod–
 = 
Ãw
 
	`QSqlR–©iÚ®TabËMod–
(
this
);

49 
bËMod–
->
	`£tTabË
("ksmsg");

50 
bËMod–
->
	`£tR–©iÚ
(
Msg_Feid
,

51 
	`QSqlR–©iÚ
("ksfile", "ksfileid", "wjmc"));

52 
bËMod–
->
	`£tF‹r
(
	`QSŒšg
("ksmsg.ksfeid = %1").
	`¬g
(
feid
));

53 
bËMod–
->
	`£tSÜt
(
Msg_D—dtime
, 
Qt
::
AsûndšgOrd”
);

54 
bËMod–
->
	`£Ëù
();

56 
QSqlTabËMod–
 *
»ÏtiÚMod–
 =

57 
bËMod–
->
	`»ÏtiÚMod–
(
Msg_Feid
);

58 
d•¬tm’tComboBox
->
	`£tMod–
(
»ÏtiÚMod–
);

59 
d•¬tm’tComboBox
->
	`£tMod–CŞumn
(

60 
»ÏtiÚMod–
->
	`f›ldIndex
("wjmc"));

62 
m­³r
 = 
Ãw
 
	`QD©aWidg‘M­³r
(
this
);

63 
m­³r
->
	`£tSubm™PŞicy
(
QD©aWidg‘M­³r
::
AutoSubm™
);

64 
m­³r
->
	`£tMod–
(
bËMod–
);

65 
m­³r
->
	`£tI‹mD–eg©e
(
Ãw
 
	`QSqlR–©iÚ®D–eg©e
(
this
));

66 
m­³r
->
	`addM­pšg
(
ÇmeEd™
, 
Msg_MsgcÚ‹Á
);

67 
m­³r
->
	`addM­pšg
(
d•¬tm’tComboBox
, 
Msg_Feid
);

68 
m­³r
->
	`addM­pšg
(
ex‹nsiÚLšeEd™
, 
Msg_msgpubtime
);

69 
m­³r
->
	`addM­pšg
(
emaEd™
, 
Msg_Ksid
);

70 
m­³r
->
	`addM­pšg
(
¡¬tD©eEd™
, 
Msg_D—dtime
);

72 ià(
id
 != -1) {

73 
row
 = 0;„ow < 
bËMod–
->
	`rowCouÁ
(); ++row) {

74 
QSqlRecÜd
 
»cÜd
 = 
bËMod–
->
	`»cÜd
(
row
);

75 ià(
»cÜd
.
	`v®ue
(
Msg_Id
).
	`toIÁ
(è=ğ
id
) {

76 
m­³r
->
	`£tCu¼’tIndex
(
row
);

81 
m­³r
->
	`toFœ¡
();

89 
	`cÚÃù
(
addBu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`addEm¶oy“
()));

90 
	`cÚÃù
(
d–‘eBu‰Ú
, 
	`SIGNAL
(
	`şicked
()),

91 
this
, 
	`SLOT
(
	`d–‘eEm¶oy“
()));

92 
	`cÚÃù
(
şo£Bu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`acû±
()));

103 
QGridLayout
 *
mašLayout
 = 
Ãw
 QGridLayout;

105 
mašLayout
->
	`addWidg‘
(
ÇmeLab–
, 1, 0);

106 
mašLayout
->
	`addWidg‘
(
ÇmeEd™
, 1, 1, 1, 2);

107 
mašLayout
->
	`addWidg‘
(
d•¬tm’tLab–
, 2, 0);

108 
mašLayout
->
	`addWidg‘
(
d•¬tm’tComboBox
, 2, 1, 1, 2);

109 
mašLayout
->
	`addWidg‘
(
ex‹nsiÚLab–
, 3, 0);

110 
mašLayout
->
	`addWidg‘
(
ex‹nsiÚLšeEd™
, 3, 1);

111 
mašLayout
->
	`addWidg‘
(
emaLab–
, 4, 0);

112 
mašLayout
->
	`addWidg‘
(
emaEd™
, 4, 1, 1, 2);

113 
mašLayout
->
	`addWidg‘
(
¡¬tD©eLab–
, 5, 0);

114 
mašLayout
->
	`addWidg‘
(
¡¬tD©eEd™
, 5, 1);

115 
mašLayout
->
	`addWidg‘
(
bu‰ÚBox
, 7, 0, 1, 3);

116 
mašLayout
->
	`£tRowMšimumHeight
(6, 10);

117 
mašLayout
->
	`£tRowSŒ‘ch
(6, 1);

118 
mašLayout
->
	`£tCŞumnSŒ‘ch
(2, 1);

119 
	`£tLayout
(
mašLayout
);

126 
ÇmeEd™
->
	`£tFocus
();

129 
	`£tWšdowT™Ë
(
	`Œ
("æ¶ˆæ¯ç®¡ç†"));

130 
	}
}

132 
	gEm¶oy“FÜm
::
	$dÚe
(
»suÉ
)

134 
m­³r
->
	`subm™
();

135 
QDŸlog
::
	`dÚe
(
»suÉ
);

136 
	}
}

138 
	gEm¶oy“FÜm
::
	$addEm¶oy“
()

140 
row
 = 
m­³r
->
	`cu¼’tIndex
();

141 
m­³r
->
	`subm™
();

142 
bËMod–
->
	`š£¹Row
(
row
);

143 
m­³r
->
	`£tCu¼’tIndex
(
row
);

145 
ÇmeEd™
->
	`ş—r
();

146 
ex‹nsiÚLšeEd™
->
	`ş—r
();

147 
¡¬tD©eEd™
->
	`£tD©e
(
QD©e
::
	`cu¼’tD©e
());

148 
ÇmeEd™
->
	`£tFocus
();

149 
	}
}

151 
	gEm¶oy“FÜm
::
	$d–‘eEm¶oy“
()

153 
row
 = 
m­³r
->
	`cu¼’tIndex
();

154 
bËMod–
->
	`»moveRow
(
row
);

155 
m­³r
->
	`subm™
();

156 
m­³r
->
	`£tCu¼’tIndex
(
	`qMš
(
row
, 
bËMod–
->
	`rowCouÁ
() - 1));

157 
	}
}

	@employeeform.h

1 #iâdeà
EMPLOYEEFORM_H


2 
	#EMPLOYEEFORM_H


	)

3 
	~<QtWidg‘s
>

4 
	~<QDŸlog
>

6 
şass
 
	gQComboBox
;

7 
şass
 
	gQD©aWidg‘M­³r
;

8 
şass
 
	gQD©eEd™
;

9 
şass
 
	gQDŸlogBu‰ÚBox
;

10 
şass
 
	gQLab–
;

11 
şass
 
	gQLšeEd™
;

12 
şass
 
	gQPushBu‰Ú
;

13 
şass
 
	gQSqlR–©iÚ®TabËMod–
;

16 
	mMsg_Id
 = 0,

17 
	mMsg_MsgcÚ‹Á
 = 1,

18 
	mMsg_msgpubtime
 = 2,

19 
	mMsg_Feid
 = 3,

20 
	mMsg_Ksid
 = 4,

21 
	mMsg_D—dtime
 = 5

24 şas 
	cEm¶oy“FÜm
 : 
public
 
QDŸlog


26 
Q_OBJECT


28 
public
:

29 
Em¶oy“FÜm
(
id
,
feid
, 
QWidg‘
 *
·»Á
 = 0);

31 
dÚe
(
»suÉ
);

33 
´iv©e
 
	m¦Ùs
:

34 
addEm¶oy“
();

35 
d–‘eEm¶oy“
();

37 
	m´iv©e
:

38 
QSqlR–©iÚ®TabËMod–
 *
bËMod–
;

39 
QD©aWidg‘M­³r
 *
	mm­³r
;

40 
QLab–
 *
	mÇmeLab–
;

41 
QLab–
 *
	md•¬tm’tLab–
;

42 
QLab–
 *
	mex‹nsiÚLab–
;

43 
QLab–
 *
	memaLab–
;

44 
QLab–
 *
	m¡¬tD©eLab–
;

45 
QLšeEd™
 *
	mÇmeEd™
;

46 
QComboBox
 *
	md•¬tm’tComboBox
;

47 
QLšeEd™
 *
	mex‹nsiÚLšeEd™
;

48 
QLšeEd™
 *
	memaEd™
;

49 
QD©eEd™
 *
	m¡¬tD©eEd™
;

50 
QPushBu‰Ú
 *
	mfœ¡Bu‰Ú
;

51 
QPushBu‰Ú
 *
	m´eviousBu‰Ú
;

52 
QPushBu‰Ú
 *
	mÃxtBu‰Ú
;

53 
QPushBu‰Ú
 *
	mÏ¡Bu‰Ú
;

54 
QPushBu‰Ú
 *
	maddBu‰Ú
;

55 
QPushBu‰Ú
 *
	md–‘eBu‰Ú
;

56 
QPushBu‰Ú
 *
	mşo£Bu‰Ú
;

57 
QDŸlogBu‰ÚBox
 *
	mbu‰ÚBox
;

	@fileform.cpp

1 
	~<QtSql
>

2 
	~<QtWidg‘s
>

3 
	~"FeFÜm.h
"

4 
	~<QMes§geBox
>

6 
	gFeFÜm
::
	$FeFÜm
(
feid
,
QWidg‘
 *
·»Á
)

7 : 
	$QDŸlog
(
·»Á
)

9 
ÇmeEd™
 = 
Ãw
 
QLšeEd™
;

10 
ÇmeLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("æ–‡ä»¶åç§°:"));

11 
ÇmeLab–
->
	`£tBuddy
(
ÇmeEd™
);

14 
pubTimeEd™
 = 
Ãw
 
QD©eEd™
;

15 
pubTimeLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("å‘å¸ƒæ—¶é—´"));

16 
pubTimeLab–
->
	`£tBuddy
(
pubTimeEd™
);

18 
webAddEd™
ğ
Ãw
 
QLšeEd™
;

19 
webAddLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("æºåœ°å€"));

20 
webAddLab–
->
	`£tBuddy
(
webAddEd™
);

22 
addBu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("æ·»åŠ æ–‡ä»¶"));

23 
d–‘eBu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("åˆ é™¤æ–‡ä»¶"));

24 
şo£Bu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("å…³é—­"));

25 
subm™Bu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("æäº¤"));

27 
bu‰ÚBox
 = 
Ãw
 
QDŸlogBu‰ÚBox
;

28 
bu‰ÚBox
->
	`addBu‰Ú
(
addBu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

29 
bu‰ÚBox
->
	`addBu‰Ú
(
d–‘eBu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

30 
bu‰ÚBox
->
	`addBu‰Ú
(
subm™Bu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

31 
bu‰ÚBox
->
	`addBu‰Ú
(
şo£Bu‰Ú
, 
QDŸlogBu‰ÚBox
::
Acû±RŞe
);

33 
bËMod–
 = 
Ãw
 
	`QSqlR–©iÚ®TabËMod–
(
this
);

34 
bËMod–
->
	`£tTabË
("ksfile");

37 
bËMod–
->
	`£tF‹r
(
	`QSŒšg
("ksfe.ksfeid = %1 ").
	`¬g
(
feid
));

38 
bËMod–
->
	`£Ëù
();

40 
m­³r
 = 
Ãw
 
	`QD©aWidg‘M­³r
(
this
);

41 
m­³r
->
	`£tSubm™PŞicy
(
QD©aWidg‘M­³r
::
Mªu®Subm™
);

42 
m­³r
->
	`£tMod–
(
bËMod–
);

43 
m­³r
->
	`£tI‹mD–eg©e
(
Ãw
 
	`QSqlR–©iÚ®D–eg©e
(
this
));

44 
m­³r
->
	`addM­pšg
(
ÇmeEd™
, 
Ksfe_Wjmc
);

45 
m­³r
->
	`addM­pšg
(
pubTimeEd™
, 
Ksfe_F•utime
);

46 
m­³r
->
	`addM­pšg
(
webAddEd™
, 
Ksfe_Webadd»ss
);

59 
m­³r
->
	`£tCu¼’tIndex
(0);

61 
	`cÚÃù
(
addBu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`addFe
()));

62 
	`cÚÃù
(
d–‘eBu‰Ú
, 
	`SIGNAL
(
	`şicked
()),

63 
this
, 
	`SLOT
(
	`d–‘eFe
()));

64 
	`cÚÃù
(
şo£Bu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
QDŸlog
::
	`dÚe
(0)));

65 
	`cÚÃù
(
subm™Bu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`acû±
()));

68 
QGridLayout
 *
mašLayout
 = 
Ãw
 QGridLayout;

69 
mašLayout
->
	`addWidg‘
(
ÇmeLab–
, 1, 0);

70 
mašLayout
->
	`addWidg‘
(
ÇmeEd™
, 1, 1, 1, 2);

71 
mašLayout
->
	`addWidg‘
(
pubTimeLab–
, 2, 0);

72 
mašLayout
->
	`addWidg‘
(
pubTimeEd™
, 2, 1, 1, 2);

74 
mašLayout
->
	`addWidg‘
(
webAddLab–
, 3, 0);

75 
mašLayout
->
	`addWidg‘
(
webAddEd™
, 3, 1,1,2);

77 
mašLayout
->
	`addWidg‘
(
bu‰ÚBox
, 7, 0, 1, 3);

78 
mašLayout
->
	`£tRowMšimumHeight
(6, 10);

79 
mašLayout
->
	`£tRowSŒ‘ch
(6, 1);

80 
mašLayout
->
	`£tCŞumnSŒ‘ch
(2, 1);

81 
	`£tLayout
(
mašLayout
);

83 
ÇmeEd™
->
	`£tFocus
();

84 
	`£tWšdowT™Ë
(
	`Œ
("æ–‡ä»¶ç®¡ç†"));

85 
	}
}

87 
	gFeFÜm
::
	$dÚe
(
»suÉ
)

89 
m­³r
->
	`subm™
();

90 
QDŸlog
::
	`dÚe
(
»suÉ
);

91 
	}
}

93 
	gFeFÜm
::
	$mªu®Subm™
()

95 
m­³r
->
	`subm™
();

96 
	}
}

98 
	gFeFÜm
::
	$addFe
()

100 
row
 = 
m­³r
->
	`cu¼’tIndex
();

102 
bËMod–
->
	`š£¹Row
(
row
);

103 
m­³r
->
	`£tCu¼’tIndex
(
row
);

105 
ÇmeEd™
->
	`ş—r
();

106 
pubTimeEd™
->
	`ş—r
();

107 
webAddEd™
->
	`ş—r
();

108 
ÇmeEd™
->
	`£tFocus
();

109 
	}
}

111 
	gFeFÜm
::
	$d–‘eFe
()

113 
row
 = 
m­³r
->
	`cu¼’tIndex
();

114 
bËMod–
->
	`»moveRow
(
row
);

115 
m­³r
->
	`subm™
();

116 
m­³r
->
	`£tCu¼’tIndex
(
	`qMš
(
row
, 
bËMod–
->
	`rowCouÁ
() - 1));

117 
	}
}

	@fileform.h

1 #iâdeà
FILEFORM_H


2 
	#FILEFORM_H


	)

3 
	~<QtWidg‘s
>

4 
	~<QDŸlog
>

6 
şass
 
	gQComboBox
;

7 
şass
 
	gQD©aWidg‘M­³r
;

8 
şass
 
	gQD©eEd™
;

9 
şass
 
	gQDŸlogBu‰ÚBox
;

10 
şass
 
	gQLab–
;

11 
şass
 
	gQLšeEd™
;

12 
şass
 
	gQPushBu‰Ú
;

13 
şass
 
	gQSqlR–©iÚ®TabËMod–
;

16 
	mKsfe_Ksfeid
 = 0,

17 
	mKsfe_Ksid
 = 1,

18 
	mKsfe_Wjmc
 = 2,

19 
	mKsfe_F•utime
 = 3,

20 
	mKsfe_Webadd»ss
 = 4,

23 şas 
	cFeFÜm
 : 
public
 
QDŸlog


25 
Q_OBJECT


27 
public
:

28 
FeFÜm
(
msgid
, 
QWidg‘
 *
·»Á
 = 0);

30 
dÚe
(
»suÉ
);

31 
mªu®Subm™
();

33 
´iv©e
 
	m¦Ùs
:

34 
addFe
();

35 
d–‘eFe
();

37 
	m´iv©e
:

38 
QSqlR–©iÚ®TabËMod–
 *
bËMod–
;

39 
QD©aWidg‘M­³r
 *
	mm­³r
;

40 
QLab–
 *
	mÇmeLab–
;

41 
QLab–
 *
	mpubTimeLab–
;

42 
QLab–
 *
	mwebAddLab–
;

44 
QLšeEd™
 *
	mÇmeEd™
;

45 
QD©eEd™
 *
	mpubTimeEd™
;

46 
QLšeEd™
 *
	mwebAddEd™
;

48 
QPushBu‰Ú
 *
	maddBu‰Ú
;

49 
QPushBu‰Ú
 *
	md–‘eBu‰Ú
;

50 
QPushBu‰Ú
 *
	mşo£Bu‰Ú
;

51 
QPushBu‰Ú
 *
	msubm™Bu‰Ú
;

52 
QDŸlogBu‰ÚBox
 *
	mbu‰ÚBox
;

	@main.cpp

1 
	~<QtGui
>

2 
	~<QtSql
>

3 
	~<c¡dlib
>

4 
	~<QtWidg‘s
>

6 
	~"mašfÜm.h
"

8 
boŞ
 
	$ü—‹CÚÃùiÚ
()

10 
QSqlD©aba£
 
db
 = QSqlD©aba£::
	`addD©aba£
("QMYSQL");

13 
db
.
	`£tHo¡Name
("192.168.1.107");

14 
db
.
	`£tD©aba£Name
("bjks2");

15 
db
.
	`£tU£rName
("root");

16 
db
.
	`£tPasswÜd
("123123");

17 ià(!
db
.
	`İ’
()) {

18 
QMes§geBox
::
	`w¬nšg
(0, 
QObjeù
::
	`Œ
("Database Error"),

19 
db
.
	`Ï¡E¼Ü
().
	`‹xt
());

20  
çl£
;

22  
Œue
;

23 
	}
}

25 
	$maš
(
¬gc
, *
¬gv
[])

27 
QAµliÿtiÚ
 
	`­p
(
¬gc
, 
¬gv
);

28 
	`ü—‹CÚÃùiÚ
();

29 
MašFÜm
 
fÜm
;

30 
fÜm
.
	`»size
(500, 600);

31 
fÜm
.
	`show
();

32  
­p
.
	`exec
();

33 
	}
}

	@mainform.cpp

1 
	~<QtGui
>

2 
	~<QtSql
>

3 
	~<SŒšg
>

4 
	~"em¶oy“fÜm.h
"

5 
	~"fefÜm.h
"

6 
	~"mašfÜm.h
"

8 
	gMašFÜm
::
	$MašFÜm
()

10 
	`ü—‹FePª–
();

11 
	`ü—‹MsgPª–
();

12 
	`ü—‹KaoshiPª–
();

14 
¥l™‹r
 = 
Ãw
 
	`QS¶™‹r
(
Qt
::
V”tiÿl
);

15 
¥l™‹r
->
	`£tF¿meStyË
(
QF¿me
::
StyËdPª–
);

16 
¥l™‹r
->
	`addWidg‘
(
fePª–
);

17 
¥l™‹r
->
	`addWidg‘
(
msgPª–
);

22 
addBu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("&æ·»åŠ æ–‡ä»¶."));

23 
d–‘eBu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("&åˆ é™¤æ–‡ä»¶."));

24 
ed™Bu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("ç¼–è¾‘æ¶ˆæ¯"));

25 
ed™FeBu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("ç¼–è¾‘æ–‡ä»¶"));

26 
qu™Bu‰Ú
 = 
Ãw
 
	`QPushBu‰Ú
(
	`Œ
("&Quit"));

28 
bu‰ÚBox
 = 
Ãw
 
QDŸlogBu‰ÚBox
;

29 
bu‰ÚBox
->
	`addBu‰Ú
(
addBu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

30 
bu‰ÚBox
->
	`addBu‰Ú
(
d–‘eBu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

31 
bu‰ÚBox
->
	`addBu‰Ú
(
ed™Bu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

32 
bu‰ÚBox
->
	`addBu‰Ú
(
ed™FeBu‰Ú
, 
QDŸlogBu‰ÚBox
::
AùiÚRŞe
);

33 
bu‰ÚBox
->
	`addBu‰Ú
(
qu™Bu‰Ú
, 
QDŸlogBu‰ÚBox
::
Acû±RŞe
);

35 
	`cÚÃù
(
addBu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`addfe
()));

36 
	`cÚÃù
(
d–‘eBu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`d–‘efe
()));

37 
	`cÚÃù
(
ed™Bu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`ed™msgs
()));

38 
	`cÚÃù
(
ed™FeBu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`ed™fe
()));

39 
	`cÚÃù
(
qu™Bu‰Ú
, 
	`SIGNAL
(
	`şicked
()), 
this
, 
	`SLOT
(
	`şo£
()));

41 
QVBoxLayout
 *
mašLayout
 = 
Ãw
 QVBoxLayout;

42 
mašLayout
->
	`addWidg‘
(
kaoshiPª–
);

43 
mašLayout
->
	`addWidg‘
(
¥l™‹r
);

44 
mašLayout
->
	`addWidg‘
(
bu‰ÚBox
);

46 
	`£tLayout
(
mašLayout
);

48 
	`£tWšdowT™Ë
(
	`Œ
("Staff Manager"));

50 
feV›w
->
	`£tCu¼’tIndex
(
feMod–
->
	`šdex
(0, 0));

51 
	}
}

53 
	gMašFÜm
::
	$upd©eMsgV›w
()

55 
QMod–Index
 
šdex
 = 
feV›w
->
	`cu¼’tIndex
();

56 ià(
šdex
.
	`isV®id
()) {

57 
QSqlRecÜd
 
»cÜd
 = 
feMod–
->
	`»cÜd
(
šdex
.
	`row
());

58 
id
 = 
»cÜd
.
	`v®ue
("ksfeid").
	`toIÁ
();

59 
msgMod–
->
	`£tF‹r
(
	`QSŒšg
("ksmsg.ksfeid = %1").
	`¬g
(
id
));

60 
msgLab–
->
	`£tText
(
	`Œ
("é…ç½® %1 è€ƒè¯•çš„æ¶ˆæ¯msg")

61 .
	`¬g
(
»cÜd
.
	`v®ue
("ksid").
	`toSŒšg
()));

64 
msgMod–
->
	`£tF‹r
("ksfileid = -1");

65 
msgLab–
->
	`£tText
(
	`Œ
("E&mployees"));

67 
msgMod–
->
	`£Ëù
();

68 
msgV›w
->
	`hÜizÚlH—d”
()->
	`£tVisibË
(

69 
msgMod–
->
	`rowCouÁ
() > 0);

72 
	}
}

74 
	gMašFÜm
::
	$addfe
()

76 
row
 = 
feMod–
->
	`rowCouÁ
();

77 
feMod–
->
	`š£¹Row
(
row
);

78 
QMod–Index
 
šdex
 = 
feMod–
->
	`šdex
(
row
, 
Ksfe_ksid
);

79 
feV›w
->
	`£tCu¼’tIndex
(
šdex
);

80 
feV›w
->
	`ed™
(
šdex
);

81 
	}
}

83 
	gMašFÜm
::
	$d–‘efe
()

85 
QMod–Index
 
šdex
 = 
feV›w
->
	`cu¼’tIndex
();

86 ià(!
šdex
.
	`isV®id
())

89 
QSqlD©aba£
::
	`d©aba£
().
	`Œª§ùiÚ
();

90 
QSqlRecÜd
 
»cÜd
 = 
feMod–
->
	`»cÜd
(
šdex
.
	`row
());

91 
id
 = 
»cÜd
.
	`v®ue
(
Ksfe_ksfeid
).
	`toIÁ
();

92 
nummsgs
 = 0;

94 
QSqlQu”y
 
	`qu”y
(
	`QSŒšg
("SELECT COUNT(*) FROM msg "

95 "WHERE feid = %1").
	`¬g
(
id
));

96 ià(
qu”y
.
	`Ãxt
())

97 
nummsgs
 = 
qu”y
.
	`v®ue
(0).
	`toIÁ
();

98 ià(
nummsgs
 > 0) {

99 
r
 = 
QMes§geBox
::
	`w¬nšg
(
this
, 
	`Œ
("Delete file"),

100 
	`Œ
("Delete %1‡nd‡ll its msgs?")

101 .
	`¬g
(
»cÜd
.
	`v®ue
(
Ksfe_ksid
).
	`toSŒšg
()),

102 
QMes§geBox
::
Yes
 | QMes§geBox::
No
);

103 ià(
r
 =ğ
QMes§geBox
::
No
) {

104 
QSqlD©aba£
::
	`d©aba£
().
	`rŞlback
();

108 
qu”y
.
	`exec
(
	`QSŒšg
("DELETE FROM msg "

109 "WHERE feid = %1").
	`¬g
(
id
));

112 
feMod–
->
	`»moveRow
(
šdex
.
	`row
());

113 
feMod–
->
	`subm™AÎ
();

114 
QSqlD©aba£
::
	`d©aba£
().
	`comm™
();

116 
	`upd©eMsgV›w
();

117 
feV›w
->
	`£tFocus
();

118 
	}
}

120 
	gMašFÜm
::
	$ed™msgs
()

122 
msgId
 = -1;

123 
ksfeid
 = -1;

124 
QMod–Index
 
šdex
 = 
msgV›w
->
	`cu¼’tIndex
();

125 ià(
šdex
.
	`isV®id
()) {

126 
QSqlRecÜd
 
»cÜd
 = 
msgMod–
->
	`»cÜd
(
šdex
.
	`row
());

127 
msgId
 = 
»cÜd
.
	`v®ue
(
Msg_Id
).
	`toIÁ
();

128 
ksfeid
 = 
»cÜd
.
	`v®ue
(
Msg_Feid
).
	`toIÁ
();

131 
Em¶oy“FÜm
 
	`fÜm
(
msgId
,
ksfeid
,
this
);

132 
fÜm
.
	`exec
();

133 
	`upd©eMsgV›w
();

134 
	}
}

136 
	gMašFÜm
::
	$ed™fe
()

138 
ksfeid
 = -1;

139 
QMod–Index
 
šdex
 = 
feV›w
->
	`cu¼’tIndex
();

140 ià(
šdex
.
	`isV®id
()) {

141 
QSqlRecÜd
 
»cÜd
 = 
feMod–
->
	`»cÜd
(
šdex
.
	`row
());

142 
ksfeid
 = 
»cÜd
.
	`v®ue
(
Ksfe_ksfeid
).
	`toIÁ
();

144 
FeFÜm
 
	`fÜm
(
ksfeid
,
this
);

145 
fÜm
.
	`exec
();

146 
	`upd©eFeV›w
();

147 
	}
}

148 
	gMašFÜm
::
	$ü—‹FePª–
()

150 
fePª–
 = 
Ãw
 
QWidg‘
;

151 
feMod–
 = 
Ãw
 
	`QSqlR–©iÚ®TabËMod–
(
this
);

152 
feMod–
->
	`£tTabË
("ksfile");

153 
feMod–
->
	`£tSÜt
(
Ksfe_ksid
, 
Qt
::
AsûndšgOrd”
);

158 
feMod–
->
	`£Ëù
();

160 
feV›w
 = 
Ãw
 
QTabËV›w
;

161 
feV›w
->
	`£tMod–
(
feMod–
);

162 
feV›w
->
	`£tI‹mD–eg©e
(
Ãw
 
	`QSqlR–©iÚ®D–eg©e
(
this
));

163 
feV›w
->
	`£tS–eùiÚMode
(

164 
QAb¡¿ùI‹mV›w
::
SšgËS–eùiÚ
);

165 
feV›w
->
	`£tS–eùiÚBehaviÜ
(
QAb¡¿ùI‹mV›w
::
S–eùRows
);

167 
feV›w
->
	`»sizeCŞumnsToCÚ‹Ás
();

168 
feV›w
->
	`£tEd™Trigg”s
(
QAb¡¿ùI‹mV›w
::
NoEd™Trigg”s
);

169 
feV›w
->
	`hÜizÚlH—d”
()->
	`£tSŒ‘chLa¡SeùiÚ
(
Œue
);

170 
feV›w
->
	`£tCŞumnHidd’
(0, 
Œue
);

171 
feV›w
->
	`£tCŞumnHidd’
(1, 
Œue
);

173 
feLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("Depar&tments"));

174 
feLab–
->
	`£tBuddy
(
feV›w
);

176 
	`cÚÃù
(
feV›w
->
	`£ËùiÚMod–
(),

177 
	`SIGNAL
(
	`cu¼’tRowChªged
(cÚ¡ 
QMod–Index
 &,

178 cÚ¡ 
QMod–Index
 &)),

179 
this
, 
	`SLOT
(
	`upd©eMsgV›w
()));

181 
QVBoxLayout
 *
Ïyout
 = 
Ãw
 QVBoxLayout;

182 
Ïyout
->
	`addWidg‘
(
feLab–
);

183 
Ïyout
->
	`addWidg‘
(
feV›w
);

184 
fePª–
->
	`£tLayout
(
Ïyout
);

185 
	}
}

187 
	gMašFÜm
::
	$ü—‹MsgPª–
()

189 
msgPª–
 = 
Ãw
 
QWidg‘
;

190 
msgMod–
 = 
Ãw
 
	`QSqlR–©iÚ®TabËMod–
(
this
);

191 
msgMod–
->
	`£tTabË
("ksmsg");

192 
msgMod–
->
	`£tR–©iÚ
(3,

193 
	`QSqlR–©iÚ
("ksfile","ksfileid","ksfileid"));

194 
msgMod–
->
	`£tSÜt
(
Msg_Id
, 
Qt
::
AsûndšgOrd”
);

195 
msgMod–
->
	`£tH—d”D©a
(1, 
Qt
::
HÜizÚl
,

196 
	`Œ
("æ¶ˆæ¯å†…å®¹"));

197 
msgMod–
->
	`£tH—d”D©a
(2, 
Qt
::
HÜizÚl
,

198 
	`Œ
("å‘å¸ƒæ—¶é—´"));

199 
msgMod–
->
	`£tH—d”D©a
(5, 
Qt
::
HÜizÚl
,

200 
	`Œ
("å¤±æ•ˆæ—¶é—´"));

202 
msgV›w
 = 
Ãw
 
QTabËV›w
;

203 
msgV›w
->
	`£tMod–
(
msgMod–
);

204 
msgV›w
->
	`£tS–eùiÚMode
(
QAb¡¿ùI‹mV›w
::
SšgËS–eùiÚ
);

205 
msgV›w
->
	`£tS–eùiÚBehaviÜ
(
QAb¡¿ùI‹mV›w
::
S–eùRows
);

206 
msgV›w
->
	`£tEd™Trigg”s
(
QAb¡¿ùI‹mV›w
::
NoEd™Trigg”s
);

207 
msgV›w
->
	`hÜizÚlH—d”
()->
	`£tSŒ‘chLa¡SeùiÚ
(
Œue
);

208 
msgV›w
->
	`£tCŞumnHidd’
(0, 
Œue
);

209 
msgV›w
->
	`£tCŞumnHidd’
(3, 
Œue
);

210 
msgV›w
->
	`£tCŞumnHidd’
(4, 
Œue
);

212 
msgLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("E&mployees"));

213 
msgLab–
->
	`£tBuddy
(
msgV›w
);

215 
QVBoxLayout
 *
Ïyout
 = 
Ãw
 QVBoxLayout;

216 
Ïyout
->
	`addWidg‘
(
msgLab–
);

217 
Ïyout
->
	`addWidg‘
(
msgV›w
);

218 
msgPª–
->
	`£tLayout
(
Ïyout
);

219 
	}
}

221 
	gMašFÜm
::
	$ü—‹KaoshiPª–
()

223 
kaoshiPª–
 = 
Ãw
 
QWidg‘
;

224 
kaoshiMod–
 = 
Ãw
 
	`QSqlR–©iÚ®TabËMod–
(
this
);

225 
kaoshiMod–
->
	`£tTabË
("kstype");

226 
kaoshiMod–
->
	`£Ëù
();

227 
kaoshiV›w
 = 
Ãw
 
QTabËV›w
;

228 
kaoshiV›w
->
	`£tMod–
(
kaoshiMod–
);

229 
kaoshiV›w
->
	`£tS–eùiÚMode
(
QAb¡¿ùI‹mV›w
::
SšgËS–eùiÚ
);

230 
kaoshiV›w
->
	`£tS–eùiÚBehaviÜ
(
QAb¡¿ùI‹mV›w
::
S–eùRows
);

231 
kaoshiV›w
->
	`£tEd™Trigg”s
(
QAb¡¿ùI‹mV›w
::
NoEd™Trigg”s
);

232 
kaoshiV›w
->
	`hÜizÚlH—d”
()->
	`£tSŒ‘chLa¡SeùiÚ
(
Œue
);

234 
kaoshiLab–
 = 
Ãw
 
	`QLab–
(
	`Œ
("E&mployees"));

235 
kaoshiLab–
->
	`£tBuddy
(
kaoshiV›w
);

237 
	`cÚÃù
(
kaoshiV›w
->
	`£ËùiÚMod–
(),

238 
	`SIGNAL
(
	`cu¼’tRowChªged
(cÚ¡ 
QMod–Index
 &,

239 cÚ¡ 
QMod–Index
 &)),

240 
this
, 
	`SLOT
(
	`upd©eFeV›w
()));

241 
QVBoxLayout
 *
Ïyout
 = 
Ãw
 QVBoxLayout;

242 
Ïyout
->
	`addWidg‘
(
kaoshiLab–
);

243 
Ïyout
->
	`addWidg‘
(
kaoshiV›w
);

244 
kaoshiPª–
->
	`£tLayout
(
Ïyout
);

245 
	}
}

247 
	gMašFÜm
::
	$upd©eFeV›w
()

249 
QMod–Index
 
šdex
 = 
kaoshiV›w
->
	`cu¼’tIndex
();

250 ià(
šdex
.
	`isV®id
()) {

251 
QSqlRecÜd
 
»cÜd
 = 
kaoshiMod–
->
	`»cÜd
(
šdex
.
	`row
());

252 
QSŒšg
 
id
 = 
»cÜd
.
	`v®ue
("ksid").
	`toSŒšg
();

253 
feMod–
->
	`£tF‹r
(
	`QSŒšg
("ksfe.ksid = \"%1\" ").
	`¬g
(
id
));

255 
feLab–
->
	`£tText
(
	`Œ
(" %1 æ–‡ä»¶ç®¡ç†")

256 .
	`¬g
(
»cÜd
.
	`v®ue
("k¢ame").
	`toSŒšg
()));

259 
feMod–
->
	`£tF‹r
("ksid = -1");

260 
feLab–
->
	`£tText
(
	`Œ
("è€ƒè¯•æ–‡ä»¶"));

262 
feMod–
->
	`£Ëù
();

263 
feV›w
->
	`hÜizÚlH—d”
()->
	`£tVisibË
(

264 
feMod–
->
	`rowCouÁ
() > 0);

265 
	}
}

	@mainform.h

1 #iâdeà
MAINFORM_H


2 
	#MAINFORM_H


	)

4 
	~<QWidg‘
>

6 
şass
 
	gQDŸlogBu‰ÚBox
;

7 
şass
 
	gQLab–
;

8 
şass
 
	gQMod–Index
;

9 
şass
 
	gQPushBu‰Ú
;

10 
şass
 
	gQS¶™‹r
;

11 
şass
 
	gQSqlR–©iÚ®TabËMod–
;

12 
şass
 
	gQTabËV›w
;

15 
	mKsfe_ksfeid
 = 0,

16 
	mKsfe_ksid
 = 1,

17 
	mKsfe_wjmc
 = 2,

18 
	mksfe_f•ubtime
 = 3,

19 
	mKsfe_webadd»ss
 = 4,

22 şas 
	cMašFÜm
 : 
public
 
QWidg‘


24 
Q_OBJECT


26 
public
:

27 
MašFÜm
();

29 
´iv©e
 
	m¦Ùs
:

30 
upd©eMsgV›w
();

31 
upd©eFeV›w
();

32 
addfe
();

33 
d–‘efe
();

34 
ed™msgs
();

35 
ed™fe
();

37 
	m´iv©e
:

38 
ü—‹FePª–
();

39 
ü—‹MsgPª–
();

40 
ü—‹KaoshiPª–
();

42 
QSqlR–©iÚ®TabËMod–
 *
	mfeMod–
;

43 
QSqlR–©iÚ®TabËMod–
 *
	mmsgMod–
;

44 
QSqlR–©iÚ®TabËMod–
 *
	mkaoshiMod–
;

46 
QWidg‘
 *
	mfePª–
;

47 
QWidg‘
 *
	mmsgPª–
;

48 
QWidg‘
 *
	mkaoshiPª–
;

49 
QLab–
 *
	mfeLab–
;

50 
QLab–
 *
	mmsgLab–
;

51 
QLab–
 *
	mkaoshiLab–
;

53 
QTabËV›w
 *
	mfeV›w
;

54 
QTabËV›w
 *
	mmsgV›w
;

55 
QTabËV›w
 *
	mkaoshiV›w
;

57 
QS¶™‹r
 *
	m¥l™‹r
;

58 
QS¶™‹r
 *
	mkaoshi¥l™‹r
;

60 
QPushBu‰Ú
 *
	maddBu‰Ú
;

61 
QPushBu‰Ú
 *
	md–‘eBu‰Ú
;

62 
QPushBu‰Ú
 *
	med™Bu‰Ú
;

63 
QPushBu‰Ú
 *
	med™FeBu‰Ú
;

64 
QPushBu‰Ú
 *
	mqu™Bu‰Ú
;

65 
QDŸlogBu‰ÚBox
 *
	mbu‰ÚBox
;

	@FileForm.h

1 #iâdeà
FILEFORM_H


2 
	#FILEFORM_H


	)

3 
	~<QtWidg‘s
>

4 
	~<QDŸlog
>

6 
şass
 
	gQComboBox
;

7 
şass
 
	gQD©aWidg‘M­³r
;

8 
şass
 
	gQD©eEd™
;

9 
şass
 
	gQDŸlogBu‰ÚBox
;

10 
şass
 
	gQLab–
;

11 
şass
 
	gQLšeEd™
;

12 
şass
 
	gQPushBu‰Ú
;

13 
şass
 
	gQSqlR–©iÚ®TabËMod–
;

16 
	mKsfe_Ksfeid
 = 0,

17 
	mKsfe_Ksid
 = 1,

18 
	mKsfe_Wjmc
 = 2,

19 
	mKsfe_F•utime
 = 3,

20 
	mKsfe_Webadd»ss
 = 4,

23 şas 
	cFeFÜm
 : 
public
 
QDŸlog


25 
Q_OBJECT


27 
public
:

28 
FeFÜm
(
msgid
, 
QWidg‘
 *
·»Á
 = 0);

30 
dÚe
(
»suÉ
);

31 
mªu®Subm™
();

33 
´iv©e
 
	m¦Ùs
:

34 
addFe
();

35 
d–‘eFe
();

37 
	m´iv©e
:

38 
QSqlR–©iÚ®TabËMod–
 *
bËMod–
;

39 
QD©aWidg‘M­³r
 *
	mm­³r
;

40 
QLab–
 *
	mÇmeLab–
;

41 
QLab–
 *
	mpubTimeLab–
;

42 
QLab–
 *
	mwebAddLab–
;

44 
QLšeEd™
 *
	mÇmeEd™
;

45 
QD©eEd™
 *
	mpubTimeEd™
;

46 
QLšeEd™
 *
	mwebAddEd™
;

48 
QPushBu‰Ú
 *
	maddBu‰Ú
;

49 
QPushBu‰Ú
 *
	md–‘eBu‰Ú
;

50 
QPushBu‰Ú
 *
	mşo£Bu‰Ú
;

51 
QPushBu‰Ú
 *
	msubm™Bu‰Ú
;

52 
QDŸlogBu‰ÚBox
 *
	mbu‰ÚBox
;

	@
1
.
0
8
100
employeeform.cpp
employeeform.h
fileform.cpp
fileform.h
main.cpp
mainform.cpp
mainform.h
FileForm.h
